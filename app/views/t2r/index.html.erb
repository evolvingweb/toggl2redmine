<h2>Toggle 2 Redmine <span class="date"></span></h2>

<form id="filter-form" class="t2r-form">
  <fieldset class="collapsible" id="filters">
    <legend onclick="toggleFieldset(this);">Options</legend>
    <div>
      <table id="filters-table">
        <tbody>
          <tr class="filter">
            <td class="field">
              <label for="default-activity">Default Activity</label>
            </td>
            <td class="values">
              <select id="default-activity" data-t2r-widget="RedmineActivityDropdown" placeholder="-" class="value" title="This activity will be applied to all time entries by default. You will still be able the activity for individual items before importing."></select>
            </td>
          </tr>
          <tr class="filter">
            <td class="field">
              <label for="toggl-workspace">Toggl Workspace</label>
            </td>
            <td class="values">
              <select id="toggl-workspace" data-t2r-widget="TogglWorkspaceDropdown" placeholder="-" class="value" title="Choose a Toggl workspace or leave blank to use all workspaces. If you don't use separate workspaces in Toggl, you can ignore this field."></select>
            </td>
          </tr>
          <tr class="filter">
            <td class="field">
              <label for="date">Date<span class="required"> *</span></label>
            </td>
            <td class="values">
              <input id="date" type="date" required="required" autofocus="autofocus" class="value date_value" title="Choose the date for which you want to import time entries into Redmine. Make sure your timezone is set correctly for your Redmine and Toggl accounts." />
              <span class="date_suffix last-imported">
                <span class="label">Last imported on</span>
                <span class="value" id="last-imported">&nbsp;</span>
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </fieldset>
  <p class="buttons">
    <a aria-role="button" href="#" id="btn-apply-filters" class="icon icon-checked" title="This will reload the tables below with the filters you've selected.">Apply</a>
    <a aria-role="button" href="#" id="btn-reset-filters" class="icon icon-reload">Reset</a>
    <a aria-role="button" href="https://github.com/jigarius/toggl2redmine#usage" target="_blank" id="btn-help" class="icon icon-help" title="Confused? Get started by reading the user guide.">Help</a>
    <input type="submit" hidden="hidden" />
  </p>
</form>

<div id="redmine-report-container">
  <h3>Time logged on <a href="<%= @redmine_url %>/time_entries/report?utf8=âœ“&criteria[]=user&criteria[]=project&criteria[]=issue&set_filter=1&sort=spent_on:desc&f[]=spent_on&op[spent_on]=><t-&v[spent_on][]=7&f[]=user_id&op[user_id]==&v[user_id][]=me&f[]=&c[]=project&c[]=spent_on&c[]=user&c[]=activity&c[]=issue&c[]=comments&c[]=hours&group_by=&t[]=hours&t[]=&columns=day" target="_blank">Redmine</a></h3>
  <table id="redmine-report" class="list odd-even t2r-table">
    <thead>
      <tr>
        <th class="project">Project</th>
        <th class="issue">Issue</th>
        <th class="comments">Comment</th>
        <th class="activity">Activity</th>
        <th class="hours">Hours</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
      <tr>
        <td></td>
        <td><strong>Time already logged</strong></td>
        <td></td>
        <td></td>
        <td data-property="total-hours" class="hours"></td>
        <td></td>
      </tr>
    </tfoot>
  </table>
</div>

<form id="publish-form">
  <h3>Time logged on <a href="https://toggl.com/app/timer" target="_blank">Toggl</a></h3>
  <table id="toggl-report" class="list odd-even t2r-table">
    <thead>
      <tr>
        <th class="checkbox">
          <input type="checkbox" class="check-all" value="" class="toggle-selection" title="Mark / unmark all items for editing and import. Alternatively, you can mark / unmark individual rows.">
        </th>
        <th class="status">Status</th>
        <th class="project">Project</th>
        <th class="issue">Issue</th>
        <th class="comments">Comments</th>
        <th class="activity">Activity</th>
        <th class="hours">Hours</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
    <tfoot>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td><strong>Time to be imported</strong></td>
        <td></td>
        <td></td>
        <td data-property="total-hours" class="hours"></td>
      </tr>
    </tfoot>
  </table>
  <div class="form-actions">
    <button id="btn-publish" type="submit">Import to Redmine</button>
  </div>
</form>

<% content_for :header_tags do %>
  <%= stylesheet_link_tag 't2r', :plugin => 'toggl2redmine' %>
  <%= javascript_include_tag "t2r.js", :plugin => 'toggl2redmine' %>
  <script>
    T2R.REDMINE_API_KEY = '<%= @redmine_api_key %>';
    T2R.TOGGL_API_KEY = '<%= @toggl_api_key %>';
  </script>
<% end %>

<% html_title "Toggl 2 Redmine" %>
